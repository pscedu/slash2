06/05/2017
---------

Motivation:

	* Remove the dependency of MDS on ZFS-fuse so that it can run on any file system.
	* All metadata are user visible files.
	* Help MDS run as non-root.

Feasibility:

	* We can always create links in the user space, but the open-by-handle feature
	  in the kernel makes it more efficient.

Things to change:


	* All RPCs will have to change to replace a fid with a file handle.

		- currently we path 64-bit FID around.  The value of MAX_HANDLE_SZ is 128.

	* All slash2 per-file metadata must be store in a file.  Right now, we modify
	  ZFS inode to store some slash2 specific inode information.

	* Journaling code. We don't know when the file system flushes its caches, so a 
	  replay can fail. Also, we need a way to reclaim log space - use syncfs().
	
	  Replay made easy because we never re-use FID, we never truncate.

	* We still need to keep the FID name space. Our replication script uses it and
	  it can be a quick way to do FID->name mapping.

Obstacle:

	* This is a on-disk format change.

		- mandatory: we have to store things like slash2 file size ourselves.

		- currently the metadata file of slash2 file can be huge. Last time
		  I looked, some CRC fields are probably not needed any more.

Concerns:

	* The new MDS will take some time to stablize.

	* There will be work needed to migrate existing data to the new MDS code.
